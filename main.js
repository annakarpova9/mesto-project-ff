(()=>{"use strict";function e(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",n)}function t(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",n)}function n(e){"Escape"===e.key&&t(document.querySelector(".popup_is-opened"))}function r(e){e.target.classList.contains("popup")&&t(e.target)}function o(e){e.target.classList.contains("popup__close")&&t(e.target.closest(".popup"))}var c={baseUrl:"https://nomoreparties.co/v1/wff-cohort-12",headers:{authorization:"b8df9e7d-b568-40ba-8f5a-580c29dc72c3","Content-Type":"application/json"}};function a(e){return e.ok?e.json():Promise.reject("Ошибка в then: ".concat(e.status))}function i(e){return fetch("".concat(c.baseUrl,"/").concat(e.url),{method:"".concat(e.method),headers:c.headers,body:JSON.stringify(e.body)}).then(a)}function u(e){console.log("Ошибка в catch: ".concat(e))}var l=document.querySelector("#card-template").content,s=document.querySelector(".popup_type_delete-card"),d="0";function p(t,n){var r=l.querySelector(".card").cloneNode(!0),o=r.querySelector(".card__image");o.src=t.card.link,o.alt=t.card.name,o.addEventListener("click",(function(){return t.openModalFullImage(o,c)}));var c=r.querySelector(".card__title");c.textContent=t.card.name;var a=r.querySelector(".card__delete-button");t.card.owner._id!==n?a.remove():a.addEventListener("click",(function(){d=t.card._id,r.id=d,e(s)}));var i=r.querySelector(".card__like-button"),u=r.querySelector(".card__like-amount");return u.textContent=0===t.card.likes.length?"0":t.card.likes.length,t.card.likes.some((function(e){return e._id===n}))&&i.classList.add("card__like-button_is-active"),i.addEventListener("click",(function(){return t.likeCard(t.card,i,u)})),r}function f(e,t,n){t.classList.contains("card__like-button_is-active")?i({url:"cards/likes/".concat(e._id),method:"DELETE"}).then((function(e){t.classList.remove("card__like-button_is-active"),n.textContent=0===e.likes.length?"0":e.likes.length})).catch(u):i({url:"cards/likes/".concat(e._id),method:"PUT"}).then((function(e){t.classList.add("card__like-button_is-active"),n.textContent=0===e.likes.length?"0":e.likes.length})).catch(u)}var m={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_inactive",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"};function _(e,t){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(m.inputErrorClass),t.setCustomValidity(""),n.classList.remove(m.errorClass),n.textContent=" "}function v(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(n.inactiveButtonClass)):(t.disabled=!0,t.classList.add(n.inactiveButtonClass))}function y(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);n.forEach((function(t){return _(e,t)})),v(n,r,t)}var h=document.querySelector(".places__list"),S=document.querySelectorAll(".popup"),E=document.querySelector(".popup_type_edit"),b=document.querySelector(".popup_type_new-card"),k=document.querySelector(".popup_type_image"),L=document.querySelector(".popup_type_avatar"),C=document.querySelector(".profile__edit-button"),q=document.querySelector(".profile__add-button"),g=document.forms["edit-profile"],x=g.elements.name,A=g.elements.description,T=document.forms["new-place"],I=T.elements["place-name"],w=T.elements.link,B=document.forms["delete-card"],D=document.forms.avatar,M=D.elements["avatar-link"],P=document.querySelector(".profile__info"),j=document.querySelector(".profile__image"),F=P.querySelector(".profile__title"),U=P.querySelector(".profile__description"),V=k.querySelector(".popup__image"),G=k.querySelector(".popup__caption");function H(e){P.dataset.userId=e._id,j.style.backgroundImage="url(".concat(e.avatar,")"),F.textContent=e.name,U.textContent=e.about}function N(t,n){V.src=t.src,V.alt=t.alt,G.textContent=n.textContent,e(k)}function O(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Сохранить",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Сохранение...";t.submitter.textContent=e?r:n}!function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){t.addEventListener("submit",(function(e){return e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);v(n,r,t),n.forEach((function(o){o.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?_(e,t):function(e,t,n,r){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add(r.inputErrorClass),o.textContent=n,o.classList.add(r.errorClass)}(e,t,t.validationMessage,n)}(e,o,t),v(n,r,t)}))}))}(t,e)}))}(m),Promise.all([i({url:"cards",method:"GET"}).then((function(e){return function(e){e.forEach((function(e){h.append(p({card:e,likeCard:f,openModalFullImage:N},P.dataset.userId))}))}(e)})),i({url:"users/me",method:"GET"}).then((function(e){return H(e)}))]).catch(u),S.forEach((function(e){return e.classList.add("popup_is-animated")})),S.forEach((function(e){return e.addEventListener("mousedown",r)})),S.forEach((function(e){return e.addEventListener("click",o)})),C.addEventListener("click",(function(){e(E),x.value=F.textContent,A.value=U.textContent,y(g,m)})),q.addEventListener("click",(function(){T.reset(),e(b),y(T,m)})),j.addEventListener("click",(function(){D.reset(),e(L),y(L,m)})),g.addEventListener("submit",(function(e){e.preventDefault(),O(!0,e),i({url:"users/me",method:"PATCH",body:{name:x.value,about:A.value}}).then((function(e){return H(e)})).catch(u).finally((function(){return O(!1,e)})),t(E)})),T.addEventListener("submit",(function(e){e.preventDefault(),O(!0,e),i({url:"cards",method:"POST",body:{name:I.value,link:w.value}}).then((function(e){return h.append(p({card:e,likeCard:f,openModalFullImage:N},P.dataset.userId))})).catch(u).finally((function(){return O(!1,e)})),T.reset(),t(b)})),D.addEventListener("submit",(function(e){e.preventDefault(),O(!0,e),i({url:"users/me/avatar",method:"PATCH",body:{avatar:M.value}}).then((function(e){return H(e)})).catch(u).finally((function(){return O(!1,e)})),t(L)})),B.addEventListener("submit",(function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Да",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Удаление...";e.preventDefault(),O(!0,e,n,r),i({url:"cards/".concat(d),method:"DELETE"}).then((function(e){document.getElementById(d).remove})).catch(u).finally((function(){return O(!1,e,n)})),t(s)}))})();
//# sourceMappingURL=main.js.map